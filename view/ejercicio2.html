<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Color de Ojos</title>
  <!-- Bootstrap v5.2 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<body>
  <div class="container">
    <div class="row">
      <p>Los colores de ojos se debe generar una barra para las publicadoras: MARVEL COMICS, 
        DC COMICS</p>
      <!-- Aqui renderizamos el grafico -->
      <div class="col-md-7">
        <canvas id="grafico"></canvas>
      </div>

      <!-- Ahora construiremos un formularios -->
      <div class="col-md-5">
        <h4>Resumen</h4>
        <ul id="lista-leyenda">
          <!-- Datos asincronos -->
        </ul>
        <button class="btn btn-sm btn-primary" id="actualizar">Actualizar</button>
      </div>
    </div>
  </div>

    
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


  <script>
    document.addEventListener("DOMContentLoaded",() => {
      const grafico = document.getElementById("grafico");
      const btActualizar = document.querySelector("#actualizar");
      const leyenda = document.querySelector("#lista-leyenda");
  
      const graficoBarras = new Chart(grafico, {
        type: 'bar',
        data: {
          labels: [],
          datasets: [
            {
              label: 'MARVEL COMICS',
              backgroundColor: [ 'blue'],  
              data: []
            },
            {

              label: 'dc COMICS',
              backgroundColor: [ 'red'],  
              data: []
            }
          ]
        }
      });

      function renderGraphic(coleccion = []){
      let etiquetas = [];
      let datos = [];
      leyenda.innerHTML = ``;

      coleccion.forEach(element => {
        etiquetas.push(element.colour);
        datos.push(element.total);

        const tagLi = document.createElement("li");
        tagLi.innerHTML = `${element.colour}: <strong>${element.total}</strong>`;
        leyenda.appendChild(tagLi);
      });

      //Asinacion de datos
      graficoBarras.data.labels = etiquetas;
      graficoBarras.data.datasets[0].data = datos;
      graficoBarras.update();
    }

    function loadData (){
      const parametros = new URLSearchParams();
      parametros.append("operacion", "resumenColorOjos");

      fetch('../controller/superhero.controller.php', {
        method: 'POST',
        body: parametros
      })
      .then(response => response.json())
      .then(lista => {
        renderGraphic(lista);
      })
    }
    btActualizar.addEventListener("click", loadData);
    
  
      
    })
  </script>
</body>
</html>