<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grafico de superheroes</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<body>
  <div class="container">
    <div class="row mt-3">

      <!--Aqui renderizaremos el grafico-->

      <div class="col-md-7">
        <canvas id="grafico"></canvas>
      </div>

      <div class="col-md-3">
        <h4>Resumen</h4>
        <ul id="lista-leyenda">

        </ul>
        <button type="button" id="actualizar" class="btn btn-danger">Actualizar</button>
      </div>

    </div><!--Fin row-->
  </div><!--Fin container-->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener("DOMContentLoaded",() => {
    const grafico = document.getElementById("grafico");
    const btActualizar = document.querySelector("#actualizar");
    const leyenda = document.querySelector("#lista-leyenda");

    const graficoBarras = new Chart(grafico, {
      type: 'bar',
      data: {
        labels: [],
        datasets: [
          {
            label: 'Bandos de super heroes',
            data: []
          }
        ]
      }
    })

    function renderGraphic(coleccion = []){
      let etiquetas = [];
      let datos = [];
      leyenda.innerHTML = ``;

      coleccion.forEach(element => {
        etiquetas.push(element.alignment);
        datos.push(element.total);

        const tagLi = document.createElement("li");
        tagLi.innerHTML = `${element.alignment}: <strong>${element.total}</strong>`;
        leyenda.appendChild(tagLi);
      });

      //Asinacion de datos
      graficoBarras.data.labels = etiquetas;
      graficoBarras.data.datasets[0].data = datos;
      graficoBarras.update();
    }

    function loadData (){
      const parametros = new URLSearchParams();
      parametros.append("operacion", "grafico");

      fetch('../controller/superhero.controller.php', {
        method: 'POST',
        body: parametros
      })
      .then(response => response.json())
      .then(lista => {
        renderGraphic(lista);
      })
    }
    btActualizar.addEventListener("click", loadData);
    
  })
</script>
</body>
</html>